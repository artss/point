# point-docker

## Для чего это

Чтобы получить разработческую версию пойнта с минимумом движений. И чтобы все пакеты, нужные для сбоки пойнта, не висели в вашей системе.

## Установка

Сначала установите [Docker](https://www.docker.com/) и [git](http://git-scm.com/). Пойнт будет подниматься на домене `point.local`. Если вы хотите поднять его на другом домене, измените домен в `point/Dockerfile`.

Получаем исходники и заходим в папку с ними:

```
git clone git@github.com:artss/point-docker.git
cd point-docker
```

Настраиваем (нужно получить коды для [рекапчи](https://www.google.com/recaptcha/admin)):

```
make configure
```

Собираем образ:

```
sudo make image
```

Запускаем контейнер для установки и настройки необходимых фич. В переменной `EXPOSE_TO` передайте папку, в которой хотите видеть исходники пойнта. Исходники, над которыми вы собираетесь работать, можно склонировать в эту папку заранее.

```
sudo EXPOSE_TO=$HOME/www/point make container
```

Стартуем сервис, пригодный для разработки:

```
sudo make start
```

## ДНС

Чтобы ходить на `point.local` и `*.point.local` нужно сделать ДНС-запись, указывающую на ваш IP. В DNSmasq, например, это можно сделать вот так:

```
address=/.point.local/192.168.1.20
```

## Джаббер и авторизация

Зайдите в джаббер под учётной записью пользователя, который написан в `config.mk`. Пароль совпадает с именем пользователя. Например, JID `arts@point.local` и пароль `arts`. Добавьте в контакты бота `p@point.local`, авторизуйте ему и скажите команду `login`. Он скажет ссылку, по которой можно зайти. Вы в вебморде!

## Как рулить

Зайти в контейнер:

```
sudo make login
```

Остановить контейнер:

```
sudo docker stop point
```

Запустить контейнер:

```
sudo docker start point
```

Удалить контейнер:

```
sudo docker rm point
```

Удалить образ:

```
sudo docker rmi private/point
```
